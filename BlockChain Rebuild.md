BlockChain rebuild 重构区块链

# 我们可以相信谁
每次我们睁开眼睛，如何知道我们还身处同一时空？每次和家人见面，如何知道对面的就是你的亲人？我们逛超市，完成每一次看似轻松的交易，这背后的基础，是信任，一个我们习以为常的东西。但当我们升入剖析他，会发现内含的邪恶。如果说区块链的实质是信任和交易，那么我们首先要理解恶意。

## 面对面的恶意
当世界上只有两个人的时候，是丛林法则，无所谓相信。初始化是恶意假设，犹如囚徒困境。每一方首先要做好对抗的准备，但当面对环境的压迫，对抗带来高风险，而合作带来高收益的时候，双方逐渐开始协作。合作的基础一方面是共同的利益，另一方面是随时做好应对对方盗取劳动成果的追偿。兵家有言，双方都做好了充分开战准备的时候，反而很难打起来。所以只要对方在可追偿的范围内，比如住在同一个山洞，那么面对面的交易确认就变得不那么重要。比如上午我用一个苹果和你换一条鱼，下午才发现鱼是坏的。吃坏了肚子，要找你算账，你要赔我一条鱼，外加照顾陪护。如果你还需要和我继续合作，那只能进行补偿交易，除非双方决裂。这种充满恶意假设的对抗状态，从人类开始一直持续到今天，虽然中间不乏全民向善的闪光点，但终影响有限。

合作的久了，人类产生情感，这为更大范围的合作信任建立基础。你和我都组建了各自的部落，有足够的资源使用，我们相安无事。随着活动范围的扩大，我们约定每7天回到始发地交换信息。合作任然有意义，我们都不知道下一片富饶之地在何方。但恶意任然存在，寻找资源失败的一方，有动机吞并找到资源的一方，相对应的，找到资源的一方为了避免风险完全可以不回来。但为了更大的合作和不错过更大的机会，双方预先在始发地埋下了一定的粮食，激励双方返回。但是在返程碰面前，各方先派使者来检查埋藏的食物，如果食物被提前提取，说明对方有恶意，如果食物安然，双方进一步会面。这时的贸易面对无法事后追责的问题，因为两个部落的活动范围可能相差很远，所以必须当面确认。还是我用苹果换你的鱼，但我要找一个鱼类专家确认这条鱼的价值。或者我用资源信息换你的食物，你跟着我到了资源地，交易才完成。

看似合理的交易机制里，仍然有欺诈的空间，比如我虽然没找到好资源，但是省吃简用我没碰埋下的食物，等你们出现了再把你们吞食，就像星际穿越(Interstellar)里的马特戴蒙。或者我把好食物事先藏起来，贸易时发现你们有我们需要的东西，就尾随你们等等。一切的邪恶，屈服给了人性，被人类上千年的文明驯化，被封印在日常生活之外，但是常见于商业和政治里，所谓兵不厌诈。现在，人类文明继续前进，试图进一步约束这种邪恶在商业领域里的逃窜。

## 文明的中间人
从原始部落的丛林法则，到文明社会的共识体制，再到区块链的出现，经过了很多的时期。没有人类文明的积累，我们也无法实现区块链，但现在我们暂时略过人类文明的历史进程，直接来到2012年，把一个新的发现浓缩在模拟的小岛上，这个岛叫比特岛：

有两个不认识，也许怀着恶意的A 和B，相隔很远，但是可以通讯  
他们需要一个快递员C，帮他们传递物品。而这里的快递员，都怀有无限恶意

1. 第一天，A要给B 1元钱，所以A叫来了C，把1元钱给C
   - 结果B没收到钱
2. 第二天，A把钱锁在箱子里，让C给B，同时把钥匙让D给B
   - C和D串通，B还是没有收到钱
3. 第三天，A和B沟通，每人自己做了N把锁(Alock,Block)，对应一把钥匙(Akey,Bkey)
   - A把他的锁送了很多给B，B也把他的锁给了A
   - A拿一个箱子，用B的锁锁住了1元钱，叫C交给B
   - B收到箱子，用自己的钥匙打开取到了1元钱
4. 第四天，A继续让C来寄钱，但是B一直没收到
   - 钱被C扔到了海里，威胁A说如果不给小费，就继续扔，看谁耗得起
5. 第五天，A的钱用完了，他和B商量，以后不用钱了，直接记账吧
   - A和B联名发出了一封公开信，双方平账，互不亏欠
6. 第六天，A用B的锁写了转账纸条，A付给B-1元钱，从此A账户为-1，B为1
   - A把转账纸条发送给黑暗森林里的所有人，帮忙传递给B
   - B收到了很多张，只保留了金额正确的一张(重复支付时，账户余额会不匹配)
7. 第7天，A和B快乐的做着交易
   - C很不开心，他找到了D，一个阴谋正在萌芽
   - 他们偷了B的锁，写了很多假交易， 花着A的钱，B也无所谓，A一无所知
8. 第8天，AB重新约定，转账记录上，要有对方签字才算数
   - 这样相安无事了很久，直到C,D学会了伪造签名...

后来，来了一位数学家，发明了无法被伪造的签名，和不会被破解的锁

## 可以验证的科学
我们可以相信科学吗？如果你说中心化不可信，那我为什么要相信我无法理解的科学？要相信科学至少满足一个条件，就是科学预测的结果能够很容易的验证。
### 史上最贱的数学题
![difficult math](https://raw.githubusercontent.com/linkinbird/blockchain_book/master/pic/fun_math_problem.png)

用a,b,c替换，去分母后：  
$$
a^3 + b^3 + c^3 - 3(a^2b + ab^2 + a^2c + ac^2 + b^2c + bc^2)- 5abc = 0
$$

多项式方程很容易找到某个特解，比如说， a=−1 ，b=1, c=0  
这意味着我们的立体方程（3维）实际上是个椭圆曲线  
但这里不是大家熟悉的圆锥曲线中的椭圆，而是域上亏格为1的光滑射影曲线。  
对于特征不等于2的域，它的仿射方程可以写成：   
$$
y^2=x^3+ax^2+bx+c
$$

复数域上的椭圆曲线为亏格为1的黎曼面。Mordell证明了整体域上的椭圆曲线是有限生成交换群（有限域），这是著名的BSD猜想（世界7大难题）的前提条件  
现在我们需要把椭圆曲线化成魏尔斯特拉斯（注：Weierstrass，提起他最著名的成就就是严密化微积分的ε-δ语言）形式。这是一个长得像这样的等式：  
$$
y^2=x^3+ax+b
$$

即使你不知道如何完成变换，验证它也是很容易的，或者说至少是机械的。对于我们而言，需要的变换由令人生畏的公式导出。  
$$
x=\frac{-28(a+b+2c)}{6a+6b-c}
$$
$$
y=\frac{364(a-b)}{6a+6b-c}
$$

得到的这个方程尽管看起来和原方程长得不怎么像，但确是如假包换的可靠模型  
$$
y^2=x^3+109x^2+224x
$$

从一个很好的有理数点x=−100, y=260（不是正整数解）开始，做椭圆曲线加法：  
相同点做切线，不同点做连线，取交点的垂足镜像，形成“有限加法循环群”  
![oval plus](https://raw.githubusercontent.com/linkinbird/blockchain_book/master/pic/Elliptic_function.png)

直到我们计算到9P  
```
a=154476802108746166441951315019919837485664325669565431700026634898253202035277999,  
b=36875131794129999827197811565225474825492979968971970996283137471637224634055579,  
c=4373612677928697257861252602371390152816537558161613618621437993378423467772036
```
这就是这道题的答案，你不一定看得懂过程，但是可以简单的验证答案，那么我就姑且相信科学是对的

### 无法篡改的数字签名
椭圆曲线加密算法 ECC (Elliptic curve cryptography)，以及量子时代的OTS单次抗量子签名，因为其数学上的难以伪造，但是容易验证的特点，成为了区块链信任的基石。但是要警惕，这里完成的信息，完全是信息传递的信任，在信息生成的过程里，仍然有大量的不确定性。

## 需要更多中间人
世界是邪恶的，矿工越多，好人获胜概率越大
## 是否相信自己
如何管理自己的钱包  
如何管理自己的信仰

# 为什么需要货币

解决了信任问题，交易还需要中间介质。但是比特岛上好像并没有出现货币，那货币真的是必须的吗？

## 账户余额能否为负
债务和债权：
* 债务为负，需要支付债务利息
  * 经常债务为负并不可怕，好比美国
  * 债务恶化需要止损，比如债务规模不断扩大，并且流入现金流过低
* 债权为正，可以获得资金收益
  * 太多的盈余也表示资金流转不充分
## 货币和财富
上述余额其实是将财务虚拟化了，过去积累的财富为正，未来的财富提前使用为负。货币作为财富的记账形式，理论上应该可以出现负数，因为资本体系是接收负数的。但是财富形式太复杂，还是时间的函数，所以需要一种统一的表述形式，就是货币。

反过来看，可以用货币衡量的，都是财富：
股权、品牌，固定资产，预期收益，版权等等
### 货币的形式
货币等价物历史上出现过很多，比如贝壳，但是后来发现发币量不稳定，所以改成了黄金，白银。但是钻石为什么没有成为货币等价物？通俗的等价物要满足以下条件：
* 发行量可以预估并且难以人为改变
* 首次发现前的自然分布与财富分布相对接近
  * 钻石的分布太过集中化
* 等价物质地稳定，不随时间损耗
* 等价物难以认为创造或者改造

因为货币等价物是自然物，需要用自然数表示（非负整数），所以无法体现负数，甚至不能随便用小数。债务的概念到了后期才形成

### 纸币的流通
实物等价物不利于流通，所以就有了基于信用的代金券，以所持等价物为基础进行纸币发行。因为等价物不能为负，所以代金券也不存在负数。

但是随着借贷的发生，出现了超越一般纸币的资产账务，这里就出现了债务和债权。但是资产的流通性不如纸币，因为资产的交易要伴随资产权益，是随时间变化的。所以从资产往回退一步，将资产按照当前市场的估值强制平仓进行高流通转换，就是纸币。

所以真是世界仍然以纸币为主流货币
* 从传统等价物来看，纸币是信息凭证，更加便于携带和交易
* 从超前的资产概念来看，纸币是其在当前时间强制平仓的市值，更加稳定，便于交易共识

## 理解比特币
严格意义上，比特币是账本，可以完全资产化表达的，也就是可以用负数和无限小数。但为了更广泛的世俗应用，当前版本的比特币选择了妥协：
1. 交易时验证支付账户不能为负
2. 交易单位从最大的比特币到最小的聪，仍然限制在了整数范围

理解比特币的几个层次：
* 交易中间体
  * 资本交易的版本：A在区块链记账支付给B100比特币，但是先欠着，这时A账户余额-100，B账户余额100
    * B将军火快递给A，并提取100比特币，换为美元
    * 矿工收到比特币余额，但是美元资产为负
    * 矿工为了保护自己利益，要求A强制平仓，这时A支付矿工美元，矿工和A的比特币余额都归零复位
  * 货币交易的版本：A在区块链先购买100比特币，矿工拿到美元
    * A支付比特币给B，完成交易
    * B把比特币余额提现，矿工支付美元给B，收回交易用比特币
* 赌场代币
  * 很多人看中了这个交易所，五脏俱全，使用代币可以吃喝玩乐
  * 交易所变成了赌场，里面越好玩，来玩的人越多，购买代币给赌场经营者大量过桥资金
  * 交易所关闭的一天，没有人约定强制平仓，赌场老板可以捐款走人
* 房屋预售
  * 看到赌场赚钱，很多人也想盖赌场，但是缺乏资金，所以先发行代币来众筹资金叫ICO
  * 估值主要靠赌场设计图纸(白皮书)，还有建筑工程队质量背书(开发者)，还有赌场老板不会跑路的信用担保(个人名声)
* 跨国交易
  * 国家间的外汇贸易也不过如此，由国家信用担保不会跑路
    * 中国开了赌场，很容易赢钱，美国人都要来，就是美元兑换人民币
    * 人民币不愿意卖怎么办，美国忽悠说用美元可以骂总统，所以喜欢骂总统的人用人民币换给了喜欢赌钱的美国人的美元
    * 一国的国力反映了货币的话语权，和发币量一起反映国家的市值
    * 风险来到的时候，才反应这个国家在强制平仓后的真实内里
      * 金融危机时候的英镑和澳币
  * 比特币可以作为一个国家货币来看待
    * 用美元买了比特币，是进入二次元的门票，二次国是矿工建立的
    * 反过来用比特币买了美元，是回到三次元的门票，三次元是社会人建立的
    * 区块链是一个大陆，比特币是这个大陆的物流港口，通过兑换比特币，可以方便的在整个区块大陆流通，所以比特币的需求和市值代表了整个区块链的价值。
* 财富分配
  * 不论是建赌场还是建国，新发货币，甚至新型资产都会带来财富重新分配，因为货币是财富等价物
  * 数字货币还代表财富在技术资本上的重新分配
    * 以旷工为主要受益群体的分配方式能否受到主流利益者的接受？
    * 金融玩家早已入场，老的财富积累在新分配里也有一定话语权
    * 老百姓认知带来了分配差异
  * 中国土地流通也带来了一次财富的重新分配
    * 出生年代差异带来了分配差异

## 区块链上的储物盒
单纯的货币转移只是硬币的一个面，另一个面是权利转移(物权，信息权等等)。为了完成这个转移的闭环，我们设计一个区块链上的盒子：
1. 卖方把苹果放进这个盒子，并发起两个智能合约到区块链：
   1. 支付满1元，可以锁定盒子，设置密码（也可以退款消除密码）
      1. 不同买方支付冲突的话，只接受最快付满的那一个，其他退回
      2. 在支付不满1元前，买方可以随时退款开盒子
   2. 支付满2元，可以链接盒子执行开门指令
      1. 盒子由程序控制，会监控盒子钱包地址的余额
2. 卖方把苹果盒子的支付地址发布
3. 买方支付定金，并设置密码456
   1. 50%锁定规则，恶意买方会损失一半资金，使卖方也损失同样的资金
   2. 超时可以退回
4. 买方验证用X光机扫描这个盒子，以确认这是个苹果
   1. 存在欺骗的可能，但是成本高
5. 矿工验证盒子的执行代码
   1. 盒子永远可以欺骗，我们仍然需要相信盒子的生产方
   2. 漏洞永远都在上链前的那一刻
6. 买方支付完2元钱，盒子打开，获得苹果

这个盒子只是便于理解比特币和交易的一个例子，稍后我们会深入讨论真正的区块链实体管理模式。

# 什么是公平
时间，空间，基因，继承？  
我们说比特币是一次财富分配，那么如何让这次分配更加公平？

## 公平和效率以及目标相关
### 信息不对称算法
意外流行算法：  
问你觉得这道题答案是什么？你觉得其他人会给出的答案是什么？
## POW
## POS
## 机器的公平
数据和机器也需要公平和正义
### EVM

# 如何获得计算的力量
当机器获得了意式，其计算的力量如何驾驭？
## 交易的成本
## 空间的扩展
proof of storage
### 传统的分布式文件系统
HDFS
## 算力的扩展
### 传统的分布式计算
spark等等，如何结合
## 人工智能的进击

# 从移动比特到移动原子
如何在物理世界实现区块链的效果？类似[reCAPTCHA](https://en.wikipedia.org/wiki/ReCAPTCHA)把识别人工字体的任务穿插到了验证码识别动作里。我们可以在区块链储物盒交易里做扩展：
1. 苹果已经放好
2. 随机分发100个专家来验证苹果
   1. 每次10个专家到齐以后开箱，确保没有人都换物品
   2. 专家验证后提交意见，并确认锁箱
3. 过半专家确认就可执行交易

但这里如果有一个专家作恶，交易失败，但是也面临物品的流失。移动比特和移动原子最大的差别就是成本。比特可以无成本的复制和转移，所以无效的比特币交易并不会让区块链有所缺损。但是无效的现实交易除了手续费以外，还有很多无法控制的质量流失

## 比特机器人
要完全打击作弊的空间，就需要将现实世界机械化，就是机器人化。苹果不是人放进去的，而是机器。苹果甚至不是人种植的，是直接在机器农场种植和管理，然后再投放到区块链里进行交易，最后由机器人运输队实现物流。

那么机器人由谁来建造？机器人是否真的可以信赖？

# 我们在重构谁
如果有一天机器控制了人类，机器之间是否还需要区块链？三体人的世界是否会出现区块链？  
区块链不是自然科学，是应对人类思维的定向技术，是社会科学
## 阶段性的改良
Hyperledger这类账本技术本质上是在对现有商业IT的兼容
## 新的社会经济秩序
### 自然人的数据重构
平行链
### 机器与物权的重构
EVM上二进制代码的权利和移除权
### UBI universal basic income
当生产力由机器自主完成后，人的生产关系受到冲击，按照生产关系的酬劳体系被打破。  
资源大国的高福利国家就是基于能源价值与人类生产关系脱轨带来的结果  
UBI是更加彻底的协议，生产成果按人分配，带来更大的福利自由度，芬兰已经[开始尝试](https://www.theguardian.com/inequality/2018/jan/12/money-for-nothing-is-finlands-universal-basic-income-trial-too-good-to-be-true)，2020年的美国大选也有持该理念的参选者[Yang](https://www.yang2020.com)
