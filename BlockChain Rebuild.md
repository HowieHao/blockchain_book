BlockChain rebuild 重构区块链

[TOC]

# 前言
撰写这篇手册，并不简单的因为区块链是一个热门话题，更因为随着研究的深入，你会发现这是一个相当复杂的领域。关于这一话题的信息来源无外乎三个方面：技术文档和代码，商业机构的宣传，研究机构或个人的整理。但是每一种媒体都因其形式、渠道或作者而带有某种偏见。技术文档固然详细精确，但是不够通俗，视野也不够广阔；商业宣传必定带有一定的偏向性；而看似中立的研究机构和媒体也因其背后资助方或者受众市场的差异而显现出意识形态的不同。区块链领域的技术人员喜欢强调其技术领先性，但偏偏这一领域在学术界还没有一致的评判标准。区块链商业机构流行的白皮书，只有极少数既保留了技术细节，又蕴含对整个体系的理解。媒体和研究机构里则存在一种悖论，那些对区块链理解不够深，但是想象力丰富的人，率先推出了所谓的畅销书，只能让普通人初步理解一些浅层的知识，无法用来灵活运用和价值创造。只有那些深入区块链一线的研究员才会意识到，这个领域还处在高速变化期，很多东西都没有定性，出书立著为时尚早。

笔者不是最早的区块链研究员，该手册的内容是从2017年中期的研习笔记开始，逐渐积累而来。当时大家对比特币的看法还在交易代币和价值储存间徘徊，手册第二章节会重点探讨这个问题。而近年来对于区块链技术的探索，也从基本的交易协议扩展，到共识机制扩展，和算力的扩展。这就好像同时站在了密码学，社会学，计算机科学的交叉口。这让笔者联想到6年前和时任天猫总裁的[张勇](https://baike.baidu.com/item/张勇/3126436)（逍遥子）对话时，他提到全中国真正理解“电子商务”的人可能只有10个，因为“电子商务”里包含了“电子”这个不断变化的元素，也包含了“商务”这个需要稳定，需要持久的元素。一年后张勇升任阿里集团首席运营官，如今已是集团CEO。要说到区块链蕴含的元素，一个是相对稳定的技术，一个是非常不稳定的人性。但深层次上，这两者是统一的，手册最后章节会在这里展开。也正是这种不稳定，使本文所述不敢妄称为书。要说和本册子的内容形式最像的，应该就属北大经济学教授[汪丁丁](https://baike.baidu.com/item/汪丁丁)的《经济学思想史讲义》。他不是讲具体的经济学，而是讲经济学的思想是如何演化而来的。摘录其中对思想史概念的几个解释：零散的经济思想有别于系统的经济学，经济史不同于经济学思想史，经济学思想史是对经济学核心议题的反省。估计现在很多人都遗忘了经济学的本质，其实是一门研究幸福的科学，在马歇尔的定义里是人类社会和个人的“较好生存”([wellbeing](http://www.econlib.org/library/Marshall/marP1.html))。那区块链的本质是什么呢？本手册通过对其核心原理的不断拷问，提出的观点是：**区块链不论如何称呼，其背后的技术以及发展方向，是自然规律中隐含的一种用于修复人类社会性缺陷的一系列规则设计**。

这里所说的社会性缺陷，在很早的社会协作里就已经被深刻的意识到了。现在常说的去中心化的问题，也只是这种社会性缺陷的一种表现形式。严格意义上说，去中心化不一定优于中心化，本质上还是要看社会性缺陷是什么。圣经里“[巴别塔](https://zh.wikipedia.org/wiki/巴別塔)”的故事，隐喻着人类的沟通障碍是上帝特意安排来限制人类发展的。而电影“[罗生门](https://baike.baidu.com/item/罗生门/9732555)”进一步阐述了不同的主观观察者，对同一客观事物也会产生认知偏差，就像本文开头所说的，背后受每个观察者动机的影响。甚至有非常极端的思想实验，在一个每个人都能当面阅读对方思想的城市里，一个完全透明的城市，可能比罗生门的世界更加可怕。面对这种无法改变的人性，为了维持人类社会的组织，其实已经设计出了很多的社会制度。这些制度有的偏向中心化，有的偏向去中心化，背后都是在适应不同的社会性缺陷，重建社会的信任。对此已有不少理论研究，但这些设计的出发点，始终是人类管理自己，而区块链可以说是利用宇宙规律来管理自己，是一大进步。这一进步的历程才刚刚开始，很多数学原理被重新评估并运用到这一体系之中，也不失为人类探索基础科学的一大回报。但这一波的进程能够推进多少，是否真的对社会有益，都还不得而知。但至少我们愿意相信，茫茫宇宙中，蕴含着这样的宝藏，等待人类去发现。

张翔  
2018年5月7日凌晨

# 信任的来源
社会需要信任，区块链修复信任，但信任到底是什么？当每天早上我们睁开眼睛，如何知道我们还身处同一时空？如何确信今天的太阳会升起，而且还是昨天那个太阳？每次和家人相见，如何知道对面的就是你的亲人？看似习以为常的东西，在我们反复叩问下，展现出其异常神奇的一面。我们可以先下一个简单的定义：**信任是对于事物连续性预判的把握程度**。在这个定义下，信任首先不是有无的问题，是程度的问题。科学带来了多次的工业革命，其背后就是因为对事物预判性的把握程度达到了前所未有的精度。牛顿力学带来了我们对简单机械的信任，电学用信任取代了最初对电的恐惧，相对论和量子力学让我们有勇气去探索更大的宇宙空间，也能够从最小的粒子中获取能量。但是决定论在量子理论和混沌理论中遇到了极大的阻碍，这预示着“对于事物连续性预判的把握程度”可能是有上限的，而这就是信任的极限。在信任的上限和下限之间，充满了各种人类社会的信任问题。

在对社会学信任进行展开之前，我们还需要翻开信任这枚硬币的另外一面：事物本身的可预判性是固定的，而信任的差异源于主体对信任对象的认知。人类是认知能力最强的生命体，也是唯一系统性发现和利用宇宙规律的生命体。刚性物体的力学性质最简单，也最容易认知理解；生物的化学性质较复杂，要基于大量现代化的观测手段才能认识其中的规律。所以认知能力受到信息获取手段的制约，幸好计算机科学的发展，使我们拥有了处理海量信息的能力。但是在人工智能领域，数百万乃至上亿节点的神经网络模型虽然能够提供很好的预测能力，但我们对其原理仍一知半解。所以认知能力也受到理解力的制约。回到社会学的信任问题上，在简单的测谎实验里，有靠机器进行大量数据采集分析获得的测谎结论，也有专业人员依靠观察和直觉判断的结论。但不论是基于信息的还是基于理解力的，都只能达到非常浅层的连续性预判，也就是信任。理想情况下，如果我们能够知晓对方所有的思维，而且掌握了完备的博弈理论，那么在这种信息完备，且完全理性人的假设下，可以建立完美的信任社会。但很遗憾上述两个假设都不成立，所以社会学里的信任是需要刚性制度去约束的，也就是契约。

我们逛超市，完成每一次看似轻松的交易，我们和商家的信用，如果没有契约的约束，将是及其脆弱的。但参与这个简单交易的信任元素其实非常多：商品生产厂商的品质，质检部门的尽职，物流的可靠，货品信息和标价的完整，收银结算的透明，异常问题的反馈等等等等。针对如此多的约束条件去设计契约是非常困难的，我们需要更加巧妙的方法：**对于社会群体的信任源于经济学原理**。以最简单的收银机举例，如果开发收银机软件的程序员埋了一个隐藏的后门用以窃取客户的付款资金，那么他有两种选择：开发通用的后门大量窃取资金，或者开发针对性的后门只在特定情况下窃取特定用户的小量资金。第一种情况下，开发成本相对较低，但是金额大非常容易被发现。第二种情况下，开发成本很高，收入反而降低，需要很长的时间在运气足够好没有被发现的情况下才能获利。所以最终这个程序员放弃了这个计划，在法律缺失的一些角落里，经济规律仍然起着作用。区块链最基本的作用就是解决了社群协作的信用问题，而我们对于区块链的信任，一方面基于对密码学和计算机代码的认知，另一方面也基于其按经济规律设计的契约规则。

## 信任的区块链演化

如果说区块链承载了信任和交易，那么我们也不能忘了硬币的反面，也就是恶意。通过善意和恶意的不断碰撞，我们才能充分理解区块链如何解决交易信任的问题。从世界上只有两个人的时候说起，在丛林法则里，是面对面的恶意。这时的博弈场景正好满足囚徒困境的条件，假装合作，然后侵吞对方会带来最大收益。但当双方都意识到对方的策略，采取规避态度时，合作的可能也消失了。直到环境的压迫足够大，任何一方都无法独立生存的时候，经济动力使合作与信任再次成为可能。合作的久了，人类产生情感，这为更大范围的合作信任建立基础。

我们暂且把这个合作的温床比喻为一个小岛，叫做比特岛。这里有两个人“阿稳”，和“阿北”。他们每个人都掌握一定的生成技能，需要交易合作才能生存。而且聪明的两个人已经约定使用贝壳作为记账工具来记录和换算两个人的资源交易。一开始他们住岛的东面，生活在一起。因为所有交易对双方都是透明的，所以在交换贝壳和物资的时候，双方都会对数量进行确认，一旦出现误差，可以回退到交易前的状态重头开始。这就是区块链的隐形基础，网络通信协议。这个通信层作为整个互联网的基础，就像空气一样，大家已经习以为常了。

经过了1个多月，阿稳和阿北积累了足够的物资，打算出门，分头去探索比特岛的其他区域。阿稳往南走，阿北往北走。我们把时间拨快，一年后，阿稳盘踞在岛的南面，阿北占据岛的北面。他们发明了可以远程通讯的工具，但是双方的相互猜疑让两个人不敢见面。他们殖民了岛上的原住民，让他们传递货物。阿稳尝试给原住民1个贝壳，让他去阿北那边换1个香蕉。可过了很久都没收到，两人通讯后发现原住民拿贝壳跑了。阿稳思考后换了一种策略，他打造了一个保险箱，把贝壳放在里面锁上，交给原住民A，传递给阿北。等A走后再把钥匙交给另一个原住民B，传给阿北。阿北拿齐保险箱和钥匙之后，打开箱子，取出贝壳，放进香蕉。再用同样的方式分批传递给阿稳。两个人用这样的方式，成功进行了几次交易。

但是好景不长，某天传递保险箱的原住民A和传递钥匙的B相遇了，他们很快发现钥匙的使用方法，联手把贝壳拿走了。阿稳并不气馁，他把制作保险箱的方法教给了阿北，他们每个人都做了10个自己的保险箱。双方保留自己的钥匙，但把空箱子通过原住民传到了对方手中。这一次阿稳把贝壳放进阿北制作的箱子里锁上，找原住民直接交给阿北。因为箱子是阿北制作的，钥匙只有阿北自己拥有，所以原住民没办法窃取箱子里的物资。他们俩的这种方法成功使用了很长时间。在区块链里，这种钥匙和锁的错配，就是**非对称加密**。比特币的收款地址就好像这把公开的锁，比特币支付到了这个账户，就是被这把锁锁上。只有地址所有人能够花这笔钱，因为私钥密码，也就是钥匙只有地址所有人知道。而这把锁和钥匙的生产我们稍后介绍。

原住民每天传递着无法打开的箱子，非常懊恼。有一天终于怒气爆发，把阿稳刚交给他的箱子直接扔进了海里。阿稳换了其他原住民又试了几次，还是被扔进海里。这样下去，贝壳总有一天要被耗光。所以阿稳提出了一个大胆的提议：放弃贝壳，直接用纸条来记账。双方先约定初始账户皆为0，阿稳要向阿北买香蕉，就在纸条上写：
> 阿稳支付给阿北1元，阿稳账户余额-1，阿北账户余额为 1

纸条的成本是低廉的，所以阿稳写了很多重复的纸条，交给了所有能找到的原住民。其中还真有一些单纯而空闲的原住民，把纸条交到了阿北手上。阿北收到第一张纸条，验证了收款1元后余额计算无误。阿北收到第二张纸条，计算如果再收款1元，自己的余额应该为2，所以第二组纸条不正确，直接作废。如此看完所有纸条后，他确定阿稳支付了自己1元钱，于是对应的把香蕉放进盒子里寄给了阿稳。如此一来，原来单线的货币贸易，变成了并行式的账本系统，这就是区块链里所谓**分布式账本**的起源。到这里为止都没有出现任何代币，因为交易的本质是账本，而货币只是纸质不记名账务的一个便携表现形式。另外那个箱子里的香蕉如何保证不会被扔进海里呢？这个问题在后面“从移动比特到移动原子”的章节单独讨论。

如此有效的交易协议，也没有坚持太久。某天原住民突然发现，自己可以轻易的伪造交易。他们打造了自己的箱子和钥匙，自己写了纸条：
> 阿稳支付给阿北1元，阿稳账户余额-3，阿北账户余额为3

阿北看到纸条，如约把香蕉放进了原住民的盒子里，而原住民顺利的用自己的钥匙取出了花阿稳的钱骗来的香蕉。阿稳得知后非常恼火，要求勾销这笔交易。但是阿北的香蕉已经消费了，所以无法撤回。阿稳苦想了很久，设计了一种透明的盒子，里面每张纸条都用自己特殊的笔记进行签名，并把这个方法同步给阿北。从此阿北只有确认这个签名是阿稳的，才会接受那张纸条的交易信息。这就是比特里使用的**椭圆函数签名**。

到此为止，比特岛上阿稳和阿北发明的这种交易协议，就是区块链协议的原型。期间每次的规则修改，都是为了避免恶意中间人的攻击。最终结果是一套不受中间人意志影响的可信任的交易规则。但是其中承诺的锁和钥匙不被破解的配对关系，以及无法被伪造的签名，要如何让人信服呢？这里就需要召唤数学家出马了，只有上述元素被充分证明，且用户充分的理解和认知，我们才敢说区块链保证的交易信任是优于目前的三方交易体系的。因为最开头我们定义了，信任是对事物连续性预判的把握。而基于数学的预判精度，远高于对人类行为的预判。但现在这个版本，仍然有缺陷，后面我们还会不断扩充优化这个协议，以进一步提高其可预测性。

## 可以验证的科学
我们可以相信科学吗？如果你说中心化不可信，那我为什么要相信我无法理解的科学？要相信科学至少满足一个条件，就是科学预测的结果能够很容易的验证。
### 史上最贱的数学题
![difficult math](https://raw.githubusercontent.com/linkinbird/blockchain_book/master/pic/fun_math_problem.png)

用a,b,c替换，去分母后：  
$$
a^3 + b^3 + c^3 - 3(a^2b + ab^2 + a^2c + ac^2 + b^2c + bc^2)- 5abc = 0
$$

多项式方程很容易找到某个特解，比如说， a=−1 ，b=1, c=0  
这意味着我们的立体方程（3维）实际上是个椭圆曲线  
但这里不是大家熟悉的圆锥曲线中的椭圆，而是域上亏格为1的光滑射影曲线。  
对于特征不等于2的域，它的仿射方程可以写成：   
$$
y^2=x^3+ax^2+bx+c
$$

复数域上的椭圆曲线为亏格为1的黎曼面。Mordell证明了整体域上的椭圆曲线是有限生成交换群（有限域），这是著名的BSD猜想（世界7大难题）的前提条件  
现在我们需要把椭圆曲线化成魏尔斯特拉斯（注：Weierstrass，提起他最著名的成就就是严密化微积分的ε-δ语言）形式。这是一个长得像这样的等式：  
$$
y^2=x^3+ax+b
$$

即使你不知道如何完成变换，验证它也是很容易的，或者说至少是机械的。对于我们而言，需要的变换由令人生畏的公式导出。  
$$
x=\frac{-28(a+b+2c)}{6a+6b-c}
$$
$$
y=\frac{364(a-b)}{6a+6b-c}
$$

得到的这个方程尽管看起来和原方程长得不怎么像，但确是如假包换的可靠模型  
$$
y^2=x^3+109x^2+224x
$$

从一个很好的有理数点x=−100, y=260（不是正整数解）开始，做椭圆曲线加法：  
相同点做切线，不同点做连线，取交点的垂足镜像，形成“有限加法循环群”  
![oval plus](https://raw.githubusercontent.com/linkinbird/blockchain_book/master/pic/Elliptic_function.png)

直到我们计算到9P  
```
a=154476802108746166441951315019919837485664325669565431700026634898253202035277999,  
b=36875131794129999827197811565225474825492979968971970996283137471637224634055579,  
c=4373612677928697257861252602371390152816537558161613618621437993378423467772036
```
这就是这道题的答案，你不一定看得懂过程，但是可以简单的验证答案，那么我就姑且相信科学是对的

### 无法篡改的数字签名
椭圆曲线加密算法 ECC (Elliptic curve cryptography)，以及量子时代的OTS单次抗量子签名，因为其数学上的难以伪造，但是容易验证的特点，成为了区块链信任的基石。但是要警惕，这里完成的信息，完全是信息传递的信任，在信息生成的过程里，仍然有大量的不确定性。

## 管理更多中间人
世界是邪恶的，矿工越多，好人获胜概率越大
## 是否相信自己
罗生门说了，人类自己在压力之下的记忆，可能是不可靠的。

如何管理自己的钱包  
如何管理自己的信仰

# 为什么需要货币

解决了信任问题，交易还需要中间介质。但是比特岛上好像并没有出现货币，那货币真的是必须的吗？

## 账户余额能否为负
债务和债权：
* 债务为负，需要支付债务利息
  * 经常债务为负并不可怕，好比美国
  * 债务恶化需要止损，比如债务规模不断扩大，并且流入现金流过低
* 债权为正，可以获得资金收益
  * 太多的盈余也表示资金流转不充分
## 货币和财富
上述余额其实是将财务虚拟化了，过去积累的财富为正，未来的财富提前使用为负。货币作为财富的记账形式，理论上应该可以出现负数，因为资本体系是接收负数的。但是财富形式太复杂，还是时间的函数，所以需要一种统一的表述形式，就是货币。

反过来看，可以用货币衡量的，都是财富：
股权、品牌，固定资产，预期收益，版权等等

区块链修复财富

### 货币的形式
货币等价物历史上出现过很多，比如贝壳，但是后来发现发币量不稳定，所以改成了黄金，白银。但是钻石为什么没有成为货币等价物？通俗的等价物要满足以下条件：
* 发行量可以预估并且难以人为改变
* 首次发现前的自然分布与财富分布相对接近
  * 钻石的分布太过集中化
* 等价物质地稳定，不随时间损耗
* 等价物难以认为创造或者改造

因为货币等价物是自然物，需要用自然数表示（非负整数），所以无法体现负数，甚至不能随便用小数。债务的概念到了后期才形成

### 纸币的流通
实物等价物不利于流通，所以就有了基于信用的代金券，以所持等价物为基础进行纸币发行。因为等价物不能为负，所以代金券也不存在负数。

但是随着借贷的发生，出现了超越一般纸币的资产账务，这里就出现了债务和债权。但是资产的流通性不如纸币，因为资产的交易要伴随资产权益，是随时间变化的。所以从资产往回退一步，将资产按照当前市场的估值强制平仓进行高流通转换，就是纸币。

所以真是世界仍然以纸币为主流货币
* 从传统等价物来看，纸币是信息凭证，更加便于携带和交易
* 从超前的资产概念来看，纸币是其在当前时间强制平仓的市值，更加稳定，便于交易共识

## 理解比特币
严格意义上，比特币是账本，可以完全资产化表达的，也就是可以用负数和无限小数。但为了更广泛的世俗应用，当前版本的比特币选择了妥协：
1. 交易时验证支付账户不能为负
2. 交易单位从最大的比特币到最小的聪，仍然限制在了整数范围

理解比特币的几个层次：
* 交易中间体
  * 资本交易的版本：A在区块链记账支付给B100比特币，但是先欠着，这时A账户余额-100，B账户余额100
    * B将军火快递给A，并提取100比特币，换为美元
    * 矿工收到比特币余额，但是美元资产为负
    * 矿工为了保护自己利益，要求A强制平仓，这时A支付矿工美元，矿工和A的比特币余额都归零复位
  * 货币交易的版本：A在区块链先购买100比特币，矿工拿到美元
    * A支付比特币给B，完成交易
    * B把比特币余额提现，矿工支付美元给B，收回交易用比特币
* 赌场代币
  * 很多人看中了这个交易所，五脏俱全，使用代币可以吃喝玩乐
  * 交易所变成了赌场，里面越好玩，来玩的人越多，购买代币给赌场经营者大量过桥资金
  * 交易所关闭的一天，没有人约定强制平仓，赌场老板可以捐款走人
* 房屋预售
  * 看到赌场赚钱，很多人也想盖赌场，但是缺乏资金，所以先发行代币来众筹资金叫ICO
  * 估值主要靠赌场设计图纸(白皮书)，还有建筑工程队质量背书(开发者)，还有赌场老板不会跑路的信用担保(个人名声)
* 跨国交易
  * 国家间的外汇贸易也不过如此，由国家信用担保不会跑路
    * 中国开了赌场，很容易赢钱，美国人都要来，就是美元兑换人民币
    * 人民币不愿意卖怎么办，美国忽悠说用美元可以骂总统，所以喜欢骂总统的人用人民币换给了喜欢赌钱的美国人的美元
    * 一国的国力反映了货币的话语权，和发币量一起反映国家的市值
    * 风险来到的时候，才反应这个国家在强制平仓后的真实内里
      * 金融危机时候的英镑和澳币
  * 比特币可以作为一个国家货币来看待
    * 用美元买了比特币，是进入二次元的门票，二次国是矿工建立的
    * 反过来用比特币买了美元，是回到三次元的门票，三次元是社会人建立的
    * 区块链是一个大陆，比特币是这个大陆的物流港口，通过兑换比特币，可以方便的在整个区块大陆流通，所以比特币的需求和市值代表了整个区块链的价值。
* 财富分配
  * 不论是建赌场还是建国，新发货币，甚至新型资产都会带来财富重新分配，因为货币是财富等价物
  * 数字货币还代表财富在技术资本上的重新分配
    * 以旷工为主要受益群体的分配方式能否受到主流利益者的接受？
    * 金融玩家早已入场，老的财富积累在新分配里也有一定话语权
    * 老百姓认知带来了分配差异
  * 中国土地流通也带来了一次财富的重新分配
    * 出生年代差异带来了分配差异

## 区块链上的储物盒
单纯的货币转移只是硬币的一个面，另一个面是权利转移(物权，信息权等等)。为了完成这个转移的闭环，我们设计一个区块链上的盒子：
1. 卖方把苹果放进这个盒子，并发起两个智能合约到区块链：
   1. 支付满1元，可以锁定盒子，设置密码（也可以退款消除密码）
      1. 不同买方支付冲突的话，只接受最快付满的那一个，其他退回
      2. 在支付不满1元前，买方可以随时退款开盒子
   2. 支付满2元，可以链接盒子执行开门指令
      1. 盒子由程序控制，会监控盒子钱包地址的余额
2. 卖方把苹果盒子的支付地址发布
3. 买方支付定金，并设置密码456
   1. 50%锁定规则，恶意买方会损失一半资金，使卖方也损失同样的资金
   2. 超时可以退回
4. 买方验证用X光机扫描这个盒子，以确认这是个苹果
   1. 存在欺骗的可能，但是成本高
5. 矿工验证盒子的执行代码
   1. 盒子永远可以欺骗，我们仍然需要相信盒子的生产方
   2. 漏洞永远都在上链前的那一刻
6. 买方支付完2元钱，盒子打开，获得苹果

这个盒子只是便于理解比特币和交易的一个例子，稍后我们会深入讨论真正的区块链实体管理模式。

# 什么是公平
时间，空间，基因，继承？  
我们说比特币是一次财富分配，那么如何让这次分配更加公平？

如果说对信任的修复可以做到数学的精度，那么对公平的修复，能到什么样的的程度？公平的修复最终会基于经济学原理

## 公平和效率以及目标相关
### 信息不对称算法
意外流行算法：  
问你觉得这道题答案是什么？你觉得其他人会给出的答案是什么？
## POW
## POS
代理人攻击：假装承诺，骗取选票。或者配合黑脸白脸

但不要为了去中心化而区块链，我们说了区块链是为了修复社会性缺陷。而经济学早就已经证明了，在经济规律面前，少数寡头，只要避免私下协作，就可以保证市场化效率。

## 机器的公平
数据和机器也需要公平和正义，当人类社会性缺陷被制度补齐之后，人类的协作能力终于可以和机器齐平
### EVM

# 获得计算的力量
区块链在修复社会性缺陷的同时，能否保证力量不衰减？

当机器获得了意识，其计算的力量如何驾驭？

## 交易的成本
## 空间的扩展
proof of storage
### 传统的分布式文件系统
HDFS
## 算力的扩展
### 传统的分布式计算
spark等等，如何结合
## 人工智能的进击

# 从移动比特到移动原子
如何在物理世界实现区块链的效果？类似[reCAPTCHA](https://en.wikipedia.org/wiki/ReCAPTCHA)把识别人工字体的任务穿插到了验证码识别动作里。我们可以在区块链储物盒交易里做扩展：
1. 苹果已经放好
2. 随机分发100个专家来验证苹果
   1. 每次10个专家到齐以后开箱，确保没有人都换物品
   2. 专家验证后提交意见，并确认锁箱
3. 过半专家确认就可执行交易

但这里如果有一个专家作恶，交易失败，但是也面临物品的流失。移动比特和移动原子最大的差别就是成本。比特可以无成本的复制和转移，所以无效的比特币交易并不会让区块链有所缺损。但是无效的现实交易除了手续费以外，还有很多无法控制的质量流失

## 比特机器人
要完全打击作弊的空间，就需要将现实世界机械化，就是机器人化。苹果不是人放进去的，而是机器。苹果甚至不是人种植的，是直接在机器农场种植和管理，然后再投放到区块链里进行交易，最后由机器人运输队实现物流。

那么机器人由谁来建造？机器人是否真的可以信赖？

# 透明和匿名之间
隐私和信任同样重要，因为在前言里我们提到了一种思想实验，在思想透明的城市里，能否建立合作与信任？答案是否定的，因为没有了隐私。完全信息能达到的那种信任强度，能否通过部分信息来实现？在人类社会的信任需求和隐私需求间达到平衡。

上述所有的推导，都是在信息公开透明的情况下实现的，那有没有可能既保证信息的可验证，又实现信息的匿名化？这里需要介绍另外一位可信的科学家

## Layer1 的匿名协议
### Zero knowledge proof
单笔交易本身只记录了address，已经是高度匿名的了，但是通过地址的追踪，还是可以观测到每个币的流向。这个时候在协议层可以通过[zero-knowledge proof](https://en.wikipedia.org/wiki/Zero-knowledge_proof)的进化版 [Non-interactive zero-knowledge proof](https://en.wikipedia.org/wiki/Non-interactive_zero-knowledge_proof) 将交易验证过程匿名化，区块链里的应用叫做[zkSNARKs](https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell/)。基础原理是多项式同态（[中文原理](https://www.jianshu.com/p/b6a14c472cc1)）：
* 加法同态，乘法同态，全同态
  - 对于E(x)函数，难以求得反函数，及无法从E(x)反推x
  - 单调函数，及x≠y,，则E(x)≠E(y)
  - 通过E(x)和E(y)，可以计算E(x+y) 加法同态，计算E(xy) 乘法同态...
* 加法盲验证——用于交易和账本验证
  1. A计算E(x)，E(y)，并发送给B
  1. 因为函数E(x)满足加法同态，B可以通过E(x)，E(y)计算E(x+y)
  1. B独立计算E(7)，并验证E(x+y)=E(7)
     - 但也无法保障x,y没有从原来的[1,6] 篡改为[2,5]
* 多项式盲验证——已知输入，未知EVM代码，验证结果准确性  
$$
P(X) = a_0 + a_1 \cdot X + a_2 \cdot X^2 + ... + a_d \cdot X^d
$$

  - A知道需要验证的多项式P
    - 其中a为计算参数，可以代表某种计算过程
  - B想要验证对应某个不公开s的E(P(s))，及验证某个输入的计算结果是否准确
    1. A和B可以共同选择基于椭圆函数的α对 x⋅g作为E(x)
    1. B计算g, s⋅g , … , sd⋅g和α⋅g , αs⋅g , … , αsd⋅g并发送给A，相当于之前的E(x),E(y)
    1. A同态性计算a=P(s)⋅g，b=αP(s)⋅g并回传
    1. B验证a,b为α对，则A真的知道P，且a值即为B所需校验的E(P(s))结果
      - 存在一种可能，A使用另外的一个P'多项式，也可以找到符合α的a,b对，这种情况叫做“d-power knowledge of exponent assumption”
* 任意计算验证
  - 把任意计算转换为门电路向量
  - 把向量转化为多项式
    - QAP (Quadratic Arithmetic Programs)

### 匿名交易协议
区块链里的应用很多：
* 2016年10月发布的[ZCash](https://z.cash)也是使用类似技术，优化了交易速度，弥补了部分这个技术的短板
* 2017年9月ETH 的Byzantium版本[支持](https://www.reddit.com/r/ethereum/comments/712idt/ethereum_testnet_just_verified_a_zcash_transaction/)了zk-snark proof
* 2018年2月底从比特币[分叉](https://www.reddit.com/r/BitcoinPrivate/comments/7todw0/historical_bitcoin_private_hard_fork_snapshot/)出了[Bitcoin Private](https://btcprivate.org/) (BTCP) 就是merge了ZClassicCoin (ZCL)和BTC主链的一个分叉，采用的也是zkSNARKs
* JPMorgan的[Quorum](https://www.jpmorgan.com/country/US/EN/Quorum)链是基于ETH的金融应用改造，也加入了zkproof和对特定监管节点透明的功能
* ING也有相同道路的项目[zkrangeproof](https://github.com/ing-bank/zkrangeproof)，但看起来有些凉了

## Layer2 的匿名通道和中间方
另一种简单的layer2的方法是一种mixing service中间商服务：把多个付款人，和多个收款人打乱，付款先付到资金池，然后随机轮转之后打乱支付给给收款方。
* Dash的[PrivateSend](https://dashpay.atlassian.net/wiki/spaces/DOC/pages/1146924/PrivateSend)就是这种形式，其隐私性促使其成为暗网的流行交易代币。
* 支付宝在银行的中间账户也可以扮演类似角色，对于央行来说直接隔离了资金流向的明细，所以现在央行要推网联，直接监管每一笔交易。

同样在Layer2的状态通道也可以在交易双方透明的情况下，保持对外部的匿名
* Hyperledger Fabric的private channel就是类似原理

## 算力的匿名化
交易的匿名扩展只实现了匿名验证，但在虚拟机环境里，计算的复杂度更高，简称为[secure MPC](https://en.wikipedia.org/wiki/Secure_multi-party_computation)的问题(Multiparty Computation)。通用的解决方案包括了保密数据分享已经零知识证明等等。但即使看似简单的计算，也需要定制化的协议设计：
* Two-party computation (2PC) 
  * 证明a >b 又称Millionaires' problem
    * The protocol of Hsiao-Ying Lin and Wen-Guey Tzeng
    * The protocol of Ioannidis & Ananth
* Multiparty computation (MPC)
  * 证明数据拥有 [Verifiable secret sharing](https://en.wikipedia.org/wiki/Verifiable_secret_sharing) (VSS)
    * Shamir's Secret Sharing
    * Additive Secret Sharing

通用协议在不同安全等级下还有不同的容错效果：
* 通讯是不安全的
* 中间人是恶意的
  * 恶意的程度 t < n/2
  * 非计划的恶意 Semi-Honest (Passive) Security
  * 计划的恶意 Semi-Honest (Passive) Security
  * 顾忌惩罚的恶意 Covert security
* 直接参与方是恶意的

# 我们在重构谁
如果有一天机器控制了人类，机器之间是否还需要区块链？三体人的世界是否会出现区块链？  
区块链不是自然科学，是应对人类思维的定向技术，是社会科学
## 阶段性的改良
Hyperledger这类账本技术本质上是在对现有商业IT的兼容
## 新的社会经济秩序
### 自然人的数据重构
平行链
### 机器与物权的重构
EVM上二进制代码的权利和移除权
### UBI universal basic income
当生产力由机器自主完成后，人的生产关系受到冲击，按照生产关系的酬劳体系被打破。  
资源大国的高福利国家就是基于能源价值与人类生产关系脱轨带来的结果  
UBI是更加彻底的协议，生产成果按人分配，带来更大的福利自由度，芬兰已经[开始尝试](https://www.theguardian.com/inequality/2018/jan/12/money-for-nothing-is-finlands-universal-basic-income-trial-too-good-to-be-true)，2020年的美国大选也有持该理念的参选者[Yang](https://www.yang2020.com)
